---
import { href } from '../lib/href';
import type { Post } from '../lib/postSchema';
import { regionLabel } from '../lib/regions';

interface Props {
  post: Post;
}

const { post } = Astro.props;

const benefitTypeLabel: Record<string, string> = {
  CASH: '현금',
  VOUCHER: '바우처',
  LOAN: '대출',
  TAX: '세제',
  SERVICE: '서비스',
  ETC: '기타',
};

const paymentCycleLabel: Record<string, string> = {
  ONCE: '1회',
  MONTHLY: '매월',
  YEARLY: '매년',
  ETC: '기타',
};

const period = (() => {
  const start = post.applicationPeriod?.start;
  const end = post.applicationPeriod?.end;
  if (start && end) return `${start} ~ ${end}`;
  return start || end || '';
})();

const benefitParts = [
  post.benefit?.amountText,
  post.benefit?.type ? benefitTypeLabel[post.benefit.type] ?? post.benefit.type : undefined,
].filter(Boolean);

const benefitText = benefitParts.join(' · ');
const paymentText = post.benefit?.paymentCycle
  ? paymentCycleLabel[post.benefit.paymentCycle] ?? post.benefit.paymentCycle
  : '';

const regions = post.regions?.length ? post.regions : ['ALL'];
---

<section class="mt-6 rounded-xl border border-slate-200 bg-slate-50 p-4 text-sm text-slate-700">
  <div class="space-y-4">
    {(period || benefitText || regions.length > 0) && (
      <div class="grid gap-3 sm:grid-cols-3">
        {period && (
          <div class="rounded-lg border border-slate-200 bg-white p-3">
            <p class="text-xs font-semibold text-slate-500">신청 기간</p>
            <p class="mt-1 text-sm font-medium text-slate-800">{period}</p>
            {post.applicationPeriod?.note && <p class="mt-1 text-xs text-slate-500">{post.applicationPeriod.note}</p>}
          </div>
        )}

        {benefitText && (
          <div class="rounded-lg border border-slate-200 bg-white p-3">
            <p class="text-xs font-semibold text-slate-500">지원 내용</p>
            <p class="mt-1 text-sm font-medium text-slate-800">
              {benefitText}
              {paymentText && <span class="text-xs text-slate-500"> ({paymentText})</span>}
            </p>
          </div>
        )}

        {regions.length > 0 && (
          <div class="rounded-lg border border-slate-200 bg-white p-3">
            <p class="text-xs font-semibold text-slate-500">지역</p>
            <div class="mt-1 flex flex-wrap gap-1.5">
              {regions.map((code) =>
                code === 'ALL' ? (
                  <span class="rounded-full bg-slate-100 px-2 py-0.5 text-xs font-medium text-slate-700">전국</span>
                ) : (
                  <a
                    href={href(`/region/${code}/`)}
                    class="rounded-full bg-sky-50 px-2 py-0.5 text-xs font-medium text-sky-700 hover:bg-sky-100"
                  >
                    {regionLabel(code)}
                  </a>
                )
              )}
            </div>
          </div>
        )}
      </div>
    )}

    {post.eligibility.length > 0 && (
      <div>
        <p class="mb-1 font-semibold text-slate-900">대상/조건</p>
        <ul class="list-disc space-y-1 pl-5">
          {post.eligibility.map((item) => <li>{item}</li>)}
        </ul>
      </div>
    )}

    {post.howToApply.length > 0 && (
      <div>
        <p class="mb-1 font-semibold text-slate-900">신청 방법</p>
        <ul class="list-disc space-y-1 pl-5">
          {post.howToApply.map((item) => <li>{item}</li>)}
        </ul>
      </div>
    )}

    {post.documents.length > 0 && (
      <div>
        <p class="mb-1 font-semibold text-slate-900">필요 서류</p>
        <ul class="list-disc space-y-1 pl-5">
          {post.documents.map((item) => <li>{item}</li>)}
        </ul>
      </div>
    )}

    {(post.organization || post.contact) && (
      <div class="border-t border-slate-200 pt-3 text-xs text-slate-600">
        {post.organization && <p>주관: {post.organization}</p>}
        {post.contact && <p>문의: {post.contact}</p>}
      </div>
    )}

    {post.sourceLinks.length > 0 && (
      <div class="border-t border-slate-200 pt-3">
        <p class="mb-1 font-semibold text-slate-900">출처/신청 링크</p>
        <ul class="list-disc space-y-1 pl-5">
          {post.sourceLinks.map((item) => (
            <li>
              <a href={item.url} target="_blank" rel="noopener noreferrer" class="text-sky-700 hover:underline">
                {item.title}
              </a>
            </li>
          ))}
        </ul>
      </div>
    )}
  </div>
</section>
